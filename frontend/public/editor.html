<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>New Post - Tech Blog</title>
</head>
<body>
  <h1>Create / Edit Post</h1>
  <form id="post-form">
    <input type="hidden" id="post-id">
    <input type="text" id="post-title" placeholder="Title" required>
    <input type="text" id="post-excerpt" placeholder="Excerpt">
    <textarea id="post-content" placeholder="Content" required></textarea>
    <select id="post-category"></select>
    <button type="submit">Submit</button>
  </form>
  <a href="index.html">Back to Posts</a>

  <script type="module">
  import { createPost, updatePost, fetchCategories } from './assets/js/posts.js';
  import { getCurrentUser } from './assets/js/auth.js';


    const user = await getCurrentUser();
    if (!user) window.location.href = 'login.html';

    const categories = await fetchCategories();
    const catSelect = document.getElementById('post-category');
    catSelect.innerHTML = '<option value="">Uncategorized</option>';
    categories.forEach(c => {
      const opt = document.createElement('option');
      opt.value = c.id;
      opt.textContent = c.name;
      catSelect.appendChild(opt);
    });

    const form = document.getElementById('post-form');
    form.onsubmit = async (e) => {
      e.preventDefault();
      const postId = document.getElementById('post-id').value;
      const title = document.getElementById('post-title').value;
      const excerpt = document.getElementById('post-excerpt').value;
      const content = document.getElementById('post-content').value;
      const categoryId = catSelect.value || null;

      let res;
      if (postId) res = await updatePost(postId, { title, excerpt, content, categoryId });
      else res = await createPost({ title, excerpt, content, categoryId });

      if (res.error) alert(res.error);
      else window.location.href = 'index.html';
    };
  </script>
</body>
</html>
